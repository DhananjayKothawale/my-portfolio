<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Portfolio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    <div class="admin-container">
        <header class="admin-header">
            <h1>Admin Dashboard</h1>
            <div class="admin-nav">
                <a href="{{ url_for('index') }}" class="btn btn-secondary">View Portfolio</a>
                <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">Logout</a>
            </div>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Profile Settings -->
        <section class="admin-section">
            <h2 class="admin-section-title">Profile Settings</h2>
            <form action="{{ url_for('update_settings') }}" method="POST" enctype="multipart/form-data" class="admin-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" name="profile_name" value="{{ settings.profile_name }}" required>
                    </div>
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" name="profile_title" value="{{ settings.profile_title }}" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="profile_email" value="{{ settings.profile_email }}" required>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" name="profile_location" value="{{ settings.profile_location }}" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>LinkedIn URL</label>
                    <input type="url" name="profile_linkedin" value="{{ settings.profile_linkedin }}">
                </div>
                
                <div class="form-group">
                    <label>Professional Summary</label>
                    <textarea name="profile_summary" rows="4" required>{{ settings.profile_summary }}</textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Profile Photo (JPG/PNG)</label>
                        <input type="file" name="profile_image" accept="image/*">
                        <small>Current: {{ settings.profile_image }}</small>
                    </div>
                    <div class="form-group">
                        <label>Resume (PDF)</label>
                        <input type="file" name="resume" accept=".pdf">
                        <small>Current: {{ settings.resume_path }}</small>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Update Profile</button>
            </form>
        </section>

        <!-- Skills Management -->
        <section class="admin-section">
            <h2 class="admin-section-title">Skills Management</h2>
            
            <form action="{{ url_for('add_skill') }}" method="POST" class="admin-form admin-form-inline">
                <div class="form-group">
                    <input type="text" name="category" placeholder="Category (e.g., Programming)" required>
                </div>
                <div class="form-group">
                    <input type="text" name="name" placeholder="Skill Name" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Skill</button>
            </form>
            
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Skill</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for skill in skills %}
                        <tr>
                            <td>{{ skill.category }}</td>
                            <td>{{ skill.name }}</td>
                            <td>
                                <button onclick="editSkill({{ skill.id }}, '{{ skill.category }}', '{{ skill.name }}')" class="btn-edit">Edit</button>
                                <a href="{{ url_for('delete_skill', skill_id=skill.id) }}" class="btn-delete" onclick="return confirm('Delete this skill?')">Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Services Management -->
        <section class="admin-section">
            <h2 class="admin-section-title">Services Management</h2>
            
            <form action="{{ url_for('add_service') }}" method="POST" class="admin-form">
                <div class="form-group">
                    <label>Service Title</label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label>Icon (emoji)</label>
                    <input type="text" name="icon" placeholder="ðŸ“Š">
                </div>
                <button type="submit" class="btn btn-primary">Add Service</button>
            </form>
            
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Icon</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for service in services %}
                        <tr>
                            <td>{{ service.title }}</td>
                            <td>{{ service.icon }}</td>
                            <td>
                                <button onclick='editService({{ service.id }}, {{ service.title|tojson }}, {{ service.description|tojson }}, "{{ service.icon }}")' class="btn-edit">Edit</button>
                                <a href="{{ url_for('delete_service', service_id=service.id) }}" class="btn-delete" onclick="return confirm('Delete this service?')">Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Projects Management -->
        <section class="admin-section">
            <h2 class="admin-section-title">Projects Management</h2>
            
            <form action="{{ url_for('add_project') }}" method="POST" enctype="multipart/form-data" class="admin-form">
                <div class="form-group">
                    <label>Project Title</label>
                    <input type="text" name="title" required>
                </div>
                
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Tools Used (comma-separated)</label>
                    <input type="text" name="tools" placeholder="Python, Pandas, Power BI">
                </div>
                
                <div class="form-group">
                    <label>Results (comma-separated)</label>
                    <textarea name="results" rows="2" placeholder="95% accuracy, Reduced manual effort by 80%"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>GitHub Link</label>
                        <input type="url" name="github_link">
                    </div>
                    <div class="form-group">
                        <label>LinkedIn Link</label>
                        <input type="url" name="linkedin_link">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Project Image</label>
                    <input type="file" name="image" accept="image/*">
                </div>
                
                <button type="submit" class="btn btn-primary">Add Project</button>
            </form>
            
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Tools</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                        <tr>
                            <td>{{ project.title }}</td>
                            <td>{{ project.tools[:50] }}...</td>
                            <td>
                                <button onclick='editProject({{ project.id }}, {{ project.title|tojson }}, {{ project.description|tojson }}, {{ project.tools|tojson }}, {{ project.results|tojson }}, {{ project.github_link|tojson }}, {{ project.linkedin_link|tojson }}, {{ project.image_path|tojson }})' class="btn-edit">Edit</button>
                                <a href="{{ url_for('delete_project', project_id=project.id) }}" class="btn-delete" onclick="return confirm('Delete this project?')">Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Certifications Management -->
        <section class="admin-section">
            <h2 class="admin-section-title">Certifications Management</h2>
            
            <form action="{{ url_for('add_certification') }}" method="POST" class="admin-form">
                <div class="form-group">
                    <label>Certification Title</label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Issuer</label>
                        <input type="text" name="issuer">
                    </div>
                    <div class="form-group">
                        <label>Date Earned</label>
                        <input type="text" name="date_earned" placeholder="2024">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Certification</button>
            </form>
            
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Issuer</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cert in certifications %}
                        <tr>
                            <td>{{ cert.title }}</td>
                            <td>{{ cert.issuer }}</td>
                            <td>{{ cert.date_earned }}</td>
                            <td>
                                <button onclick='editCertification({{ cert.id }}, {{ cert.title|tojson }}, {{ cert.issuer|tojson }}, {{ cert.date_earned|tojson }})' class="btn-edit">Edit</button>
                                <a href="{{ url_for('delete_certification', cert_id=cert.id) }}" class="btn-delete" onclick="return confirm('Delete this certification?')">Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Contact Messages -->
        <section class="admin-section">
            <h2 class="admin-section-title">Contact Messages</h2>
            
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for msg in messages %}
                        <tr>
                            <td>{{ msg.submitted_at }}</td>
                            <td>{{ msg.name }}</td>
                            <td>{{ msg.email }}</td>
                            <td>{{ msg.message[:100] }}...</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Edit Modals -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Edit Item</h2>
            <form id="editForm" method="POST" enctype="multipart/form-data">
                <div id="modalFormContent"></div>
                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function editSkill(id, category, name) {
            document.getElementById('modalTitle').textContent = 'Edit Skill';
            document.getElementById('editForm').action = '/admin/skills/edit/' + id;
            document.getElementById('modalFormContent').innerHTML = `
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" name="category" value="${category}" required>
                </div>
                <div class="form-group">
                    <label>Skill Name</label>
                    <input type="text" name="name" value="${name}" required>
                </div>
            `;
            document.getElementById('editModal').style.display = 'block';
        }

        function editService(id, title, description, icon) {
            document.getElementById('modalTitle').textContent = 'Edit Service';
            document.getElementById('editForm').action = '/admin/services/edit/' + id;
            document.getElementById('modalFormContent').innerHTML = `
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" value="${title}" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" required>${description}</textarea>
                </div>
                <div class="form-group">
                    <label>Icon</label>
                    <input type="text" name="icon" value="${icon}">
                </div>
            `;
            document.getElementById('editModal').style.display = 'block';
        }

        function editProject(id, title, description, tools, results, github, linkedin, imagePath) {
            document.getElementById('modalTitle').textContent = 'Edit Project';
            document.getElementById('editForm').action = '/admin/projects/edit/' + id;
            document.getElementById('modalFormContent').innerHTML = `
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" value="${title}" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" required>${description}</textarea>
                </div>
                <div class="form-group">
                    <label>Tools</label>
                    <input type="text" name="tools" value="${tools || ''}">
                </div>
                <div class="form-group">
                    <label>Results</label>
                    <textarea name="results" rows="2">${results || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>GitHub Link</label>
                    <input type="url" name="github_link" value="${github || ''}">
                </div>
                <div class="form-group">
                    <label>LinkedIn Link</label>
                    <input type="url" name="linkedin_link" value="${linkedin || ''}">
                </div>
                <div class="form-group">
                    <label>Project Image</label>
                    <input type="file" name="image" accept="image/*">
                    <input type="hidden" name="existing_image" value="${imagePath || ''}">
                    <small>Current: ${imagePath || 'None'}</small>
                </div>
            `;
            document.getElementById('editModal').style.display = 'block';
        }

        function editCertification(id, title, issuer, date) {
            document.getElementById('modalTitle').textContent = 'Edit Certification';
            document.getElementById('editForm').action = '/admin/certifications/edit/' + id;
            document.getElementById('modalFormContent').innerHTML = `
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" value="${title}" required>
                </div>
                <div class="form-group">
                    <label>Issuer</label>
                    <input type="text" name="issuer" value="${issuer || ''}">
                </div>
                <div class="form-group">
                    <label>Date Earned</label>
                    <input type="text" name="date_earned" value="${date || ''}">
                </div>
            `;
            document.getElementById('editModal').style.display = 'block';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>